# ğŸ›ï¸ Diagrama del Flujo de Compra DevMart

## Flujo Principal

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        FLUJO COMPLETO DE COMPRA                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. SELECCIONAR PRODUCTOS
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   HomePage       â”‚
   â”‚                  â”‚
   â”‚ Ver Productos    â”‚â”€â”€â”
   â”‚ (ProductCard)    â”‚  â”‚ addItem(product, qty)
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                         â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  CartContext   â”‚
                    â”‚                â”‚
                    â”‚ Guardar Items  â”‚
                    â”‚ + localStorage â”‚
                    â”‚ + Congelar $   â”‚
                    â”‚ + Validar Stockâ”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼

2. REVISAR CARRITO
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   CartPage       â”‚
   â”‚                  â”‚
   â”‚ Ver Items        â”‚â—„â”€â”
   â”‚ â•â– Cantidad   â”‚  â”‚ updateQuantity
   â”‚ âŒ Eliminar     â”‚  â”‚ removeItem
   â”‚ ğŸ’° Totales      â”‚â”€â”€â”˜
   â”‚ âœ… Checkout     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼

3. COMPLETAR CHECKOUT
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚      CheckoutPage                â”‚
   â”‚                                  â”‚
   â”‚ Paso 1: ğŸ“ DirecciÃ³n de EnvÃ­o   â”‚
   â”‚ Paso 2: ğŸ’³ MÃ©todo de Pago       â”‚
   â”‚ Paso 3: ğŸ‘ï¸  Revisar Orden       â”‚
   â”‚ Paso 4: âœ… Confirmar             â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ createNewOrder(orderData)
           â–¼
   
4. CREAR ORDEN (Backend)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   POST /orders                   â”‚
   â”‚                                  â”‚
   â”‚ {                                â”‚
   â”‚   userId: 1,                     â”‚
   â”‚   products: [...],               â”‚
   â”‚   paymentMethod: 1,              â”‚
   â”‚   address: "...",                â”‚
   â”‚   status: "PENDIENTE",           â”‚
   â”‚   total: 9180000                 â”‚
   â”‚ }                                â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Backend Crea Orden
           â”‚ Retorna: order (id: 1)
           â–¼
   
5. CREAR ENVÃO (AutomÃ¡tico)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   POST /shipments                â”‚
   â”‚                                  â”‚
   â”‚ {                                â”‚
   â”‚   orderId: 1,                    â”‚
   â”‚   status: "PENDIENTE",           â”‚
   â”‚   carrier: "Por definir",        â”‚
   â”‚   trackingId: "TRK-..."          â”‚
   â”‚ }                                â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Backend Crea EnvÃ­o
           â”‚ Retorna: shipment
           â–¼

6. CONFIRMACIÃ“N
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚      Pantalla de Ã‰xito            â”‚
   â”‚                                  â”‚
   â”‚ âœ… Orden Creada                   â”‚
   â”‚    # 1                           â”‚
   â”‚                                  â”‚
   â”‚ ğŸ“¦ EnvÃ­o Asignado                 â”‚
   â”‚    TRK-2025-11-14-12345          â”‚
   â”‚                                  â”‚
   â”‚ â†’ Ver mis Ã³rdenes                â”‚
   â”‚ â†’ Rastrear envÃ­o                 â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â–¼             â–¼            â–¼
        OrdersPage  TrackingPage   ProfilePage


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

COMPONENTES Y CONTEXTOS INVOLUCRADOS

ProductCard                CartPage               CheckoutPage
    â”‚                          â”‚                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                        CartContext
                          (items)
                               â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â–¼              â–¼              â–¼
            UserContext   useOrders    shipmentService
             (user)      (hooks)      (api calls)
                â”‚              â”‚              â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                Backend API


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

FLUJO DE DATOS - ESTRUCTURA

ORDEN CREADA:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                â”‚
â”‚  id: 1                                                         â”‚
â”‚  userId: 1  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  products: [                             â”‚                    â”‚
â”‚    { sku: "64b9e8f2...", count: 2 },     â”‚                    â”‚
â”‚    { sku: "64b9e8f2...", count: 1 }      â”‚                    â”‚
â”‚  ]                                       â”‚                    â”‚
â”‚  paymentMethod: 1 (Tarjeta de CrÃ©dito)   â”‚                    â”‚
â”‚  address: "123 Main Street..."           â”‚                    â”‚
â”‚  status: "PENDIENTE"                     â”‚                    â”‚
â”‚  total: 9,180,000 COP                    â”‚                    â”‚
â”‚  createdAt: "2025-11-11T23:50:41.587Z"   â”‚                    â”‚
â”‚  updatedAt: "2025-11-11T23:50:41.587Z"   â”‚                    â”‚
â”‚                                          â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼

ENVÃO CREADO:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                â”‚
â”‚  id: 1                                                         â”‚
â”‚  orderId: 1  â”€â”€â”€â”€â”€â”€â”€â”€â”  (FK a Orders)                         â”‚
â”‚  status: "PENDIENTE"  â”‚                                        â”‚
â”‚  carrier: "Servientrega"                                       â”‚
â”‚  trackingId: "TRK-20251011-00046"                             â”‚
â”‚  createdAt: "2025-11-10T22:49:36.790Z"                        â”‚
â”‚  updatedAt: "2025-11-14T04:18:29.254Z"                        â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PARÃMETROS DE NEGOCIO

CARRITO:
  â€¢ ExpiraciÃ³n: 24 horas de inactividad
  â€¢ CongelaciÃ³n de precio: 2 horas por item
  â€¢ Persistencia: localStorage (key: devmart_cart)

ORDEN:
  â€¢ MÃ­nimo: $50,000 COP
  â€¢ Estados: PENDIENTE â†’ PREPARANDO â†’ EN_TRANSITO â†’ EN_ENTREGA â†’ ENTREGADO
  â€¢ Cancelable: SÃ (estado: CANCELADO)

ENVÃO:
  â€¢ EnvÃ­o gratis: Si total â‰¥ $50,000 COP
  â€¢ EnvÃ­o pagado: 5% o $10,000 mÃ­n (lo que sea mayor)
  â€¢ Carrier: Se define automÃ¡ticamente o por admin

PRODUCTO:
  â€¢ SKU: Identificador Ãºnico
  â€¢ Stock: Se valida en carrito y checkout


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ARCHIVOS CLAVE DEL PROYECTO

Contextos:
  â€¢ src/contexts/CartProvider.jsx          â†’ GestiÃ³n del carrito
  â€¢ src/contexts/UserProvider.jsx          â†’ InformaciÃ³n del usuario
  â€¢ src/contexts/ProductProvider.jsx       â†’ CatÃ¡logo de productos

Hooks:
  â€¢ src/hooks/useOrders.js                 â†’ Crear y obtener Ã³rdenes
  â€¢ src/hooks/useShipments.js              â†’ GestiÃ³n de envÃ­os
  â€¢ src/hooks/useCategories.js             â†’ CategorÃ­as

Servicios:
  â€¢ src/api/ordersService.js               â†’ API de Ã³rdenes
  â€¢ src/api/shipmentService.js             â†’ API de envÃ­os
  â€¢ src/api/productsService.js             â†’ API de productos
  â€¢ src/api/apiClient.js                   â†’ Cliente HTTP (Axios)

PÃ¡ginas:
  â€¢ src/pages/CartPage.jsx                 â†’ Carrito
  â€¢ src/pages/CheckoutPage.jsx             â†’ Checkout
  â€¢ src/pages/OrdersPage.jsx               â†’ Mis Ã³rdenes
  â€¢ src/pages/TrackingUserPage.jsx         â†’ Rastreo de envÃ­os
  â€¢ src/pages/ProfilePage.jsx              â†’ Perfil de usuario

Reductores:
  â€¢ src/reducers/cartReducer.js            â†’ LÃ³gica del carrito
  â€¢ src/reducers/authReducer.js            â†’ LÃ³gica de autenticaciÃ³n
  â€¢ src/reducers/productReducer.js         â†’ LÃ³gica de productos


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

VALIDACIONES EN CHECKOUT

Paso 1 - DirecciÃ³n:
  âœ“ MÃ­nimo 10 caracteres
  âœ“ Requerida

Paso 2 - Pago:
  âœ“ Seleccionar mÃ©todo (Tarjeta o Transferencia)

Paso 3 - RevisiÃ³n:
  âœ“ Mostrar resumen completo
  âœ“ Confirmar totales

Restricciones de Orden:
  âœ“ MÃ­nimo $50,000 COP
  âœ“ Al menos 1 producto
  âœ“ Usuario autenticado


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ESTADOS POSIBLES

ORDEN:
  PENDIENTE      â†’ Orden acaba de crearse
  PREPARANDO     â†’ Se estÃ¡ preparando en almacÃ©n
  EN_TRANSITO    â†’ En camino al cliente
  EN_ENTREGA     â†’ LlegÃ³ al domicilio
  ENTREGADO      â†’ Entregada al cliente
  CANCELADO      â†’ Orden cancelada

ENVÃO:
  PENDIENTE      â†’ EnvÃ­o creado, sin asignar carrier
  PREPARANDO     â†’ Se prepara el producto para envÃ­o
  EN_TRANSITO    â†’ En proceso de envÃ­o
  EN_ENTREGA     â†’ En puerta del cliente
  ENTREGADO      â†’ Entregado exitosamente
  CANCELADO      â†’ EnvÃ­o cancelado


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## ğŸ” Pruebas Recomendadas

### Test 1: Flujo Completo
1. Agregar 2 productos al carrito
2. Ir a checkout
3. Completar direcciÃ³n (>10 chars)
4. Seleccionar mÃ©todo de pago
5. Confirmar orden
6. âœ… Debe aparecer confirmaciÃ³n con nÃºmero de orden y trackingId

### Test 2: Visualizar Orden
1. Ir a "Mis Ã“rdenes"
2. âœ… Debe aparecer la orden reciÃ©n creada
3. âœ… Status debe ser "PENDIENTE"
4. âœ… Total debe coincidir

### Test 3: Rastrear EnvÃ­o
1. Ir a "Tracking" â†’ "Mis EnvÃ­os"
2. âœ… Debe aparecer el envÃ­o asociado a la orden
3. âœ… Status debe ser "PENDIENTE"
4. âœ… TrackingId debe coincidir con la confirmaciÃ³n

### Test 4: Buscar por GuÃ­a
1. Copiar el trackingId de la confirmaciÃ³n
2. Ir a "Tracking" â†’ "Buscar por GuÃ­a"
3. Ingresar el trackingId
4. âœ… Debe mostrar los detalles del envÃ­o

---

**Fecha de CreaciÃ³n:** 2025-11-14
**VersiÃ³n:** 1.0
**Estado:** Funcional âœ…
